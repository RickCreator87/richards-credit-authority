1. Schemas

schemas/authority.schema.yaml

```yaml
# schemas/authority.schema.yaml
# Authority and permission granting schema

$schema: http://json-schema.org/draft-07/schema#
$id: https://github.com/RickCreator87/richards-credit-authority/schemas/authority.schema.yaml

title: Credit Authority Schema
description: Defines authority structures and permission grants
version: 1.0.0

type: object
required:
  - authority_id
  - identity_reference
  - granted_at
  - status
  - permissions

properties:
  authority_id:
    type: string
    pattern: "^auth_[A-Za-z0-9_-]+$"
    description: Unique authority identifier

  identity_reference:
    type: string
    description: Reference to the identity this authority is granted to
    oneOf:
      - type: string
        format: uuid
      - type: string
        pattern: "^id_[A-Za-z0-9]+$"

  type:
    type: string
    enum:
      - credit_issuer
      - credit_verifier
      - system_administrator
      - auditor
      - delegate
      - compliance_officer
    description: Type of authority being granted

  granted_at:
    type: string
    format: date-time
    description: When this authority was granted

  expires_at:
    type: string
    format: date-time
    description: When this authority expires

  status:
    type: string
    enum:
      - active
      - pending
      - suspended
      - revoked
      - expired
    default: active

  granted_by:
    type: string
    description: Who or what granted this authority
    oneOf:
      - type: string
        format: uuid
      - type: string
        enum: ["system", "auto_grant", "manual_approval"]

  permissions:
    type: array
    items:
      type: string
      enum:
        - read_self
        - update_contact
        - create_request
        - view_credit_summary
        - issue_credit
        - revoke_credit
        - delegate_auth
        - bulk_verify
        - issue_authority
        - audit_access
        - system_config
        - tax_override
        - compliance_override
    uniqueItems: true

  scope:
    type: object
    properties:
      geographic:
        type: array
        items:
          type: string
          pattern: "^[A-Z]{2}$"
        description: ISO country codes where authority is valid

      monetary_limits:
        type: object
        properties:
          max_credit_issuance:
            type: number
            minimum: 0
          max_daily_transactions:
            type: integer
            minimum: 0
          max_transaction_amount:
            type: number
            minimum: 0

      temporal:
        type: object
        properties:
          valid_hours:
            type: array
            items:
              type: object
              properties:
                day:
                  type: string
                  enum: ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]
                start:
                  type: string
                  pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
                end:
                  type: string
                  pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
          timezone:
            type: string
            default: "UTC"

  constraints:
    type: object
    properties:
      requires_approval:
        type: boolean
        default: true
      requires_dual_approval:
        type: boolean
        default: false
      audit_frequency:
        type: string
        enum: ["daily", "weekly", "monthly", "quarterly", "annually"]
        default: "monthly"
      restrictions:
        type: array
        items:
          type: string

  delegation_chain:
    type: array
    items:
      type: object
      properties:
        authority_id:
          type: string
        granted_at:
          type: string
          format: date-time
        granted_by:
          type: string

  audit_trail:
    type: array
    items:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        action:
          type: string
        performed_by:
          type: string
        details:
          type: object

  tax_implications:
    type: object
    properties:
      jurisdiction:
        type: string
      withholding_required:
        type: boolean
      tax_liability:
        type: number
        minimum: 0
      forms_required:
        type: array
        items:
          type: string

  metadata:
    type: object
    properties:
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
      version:
        type: string
      tags:
        type: array
        items:
          type: string

additionalProperties: false

examples:
  - authority_id: "auth_20240115_143000_abc123"
    identity_reference: "550e8400-e29b-41d4-a716-446655440000"
    type: "credit_issuer"
    granted_at: "2024-01-15T14:30:00Z"
    expires_at: "2025-01-15T14:30:00Z"
    status: "active"
    granted_by: "system"
    permissions:
      - "issue_credit"
      - "view_credit_summary"
      - "create_request"
    scope:
      geographic: ["US", "CA"]
      monetary_limits:
        max_credit_issuance: 1000000
        max_daily_transactions: 100
        max_transaction_amount: 50000
    constraints:
      requires_approval: false
      audit_frequency: "monthly"
    metadata:
      created_at: "2024-01-15T14:30:00Z"
      updated_at: "2024-01-15T14:30:00Z"
      version: "1.0"
      tags: ["premium", "automated_grant"]
``

